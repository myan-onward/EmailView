@page "/rules"

@if (LoggedIn == false)
{
    <p>Not logged into a mailbox.</p>
    <NavLink href="account/login" class="btn btn-link"><span class="oi oi-account-logout" aria-hidden="true"></span> Login
    </NavLink>
}
else
{
    @if (rules == null)
    {
        <p><em>Loading Rules...</em></p>
    }
    else
    {
        <table class="table table-striped table-bordered table-hover table-sm">
            <thead><h4>Rules</h4></thead>
            <tbody>
                <Virtualize Items="@rules" Context="rule">
                    <tr>
                        <td>
                            <div class="container">
                                <div class="row align-items-start justify-content-start">
                                    <div class="col-1">Rule Shared? 
                                        @* <input asp-for="rule.Shared"> *@
                                        <input name="IsShared" type="checkbox" value="@rule.Shared" />
                                        </div>
                                    <div class="col-6"><strong>Rule Name: @rule.Name</strong></div>
                                    <div class="col-3">All Conditions? 
                                        @* <input asp-for="rule.RequireAllConditions"> *@
                                        <input name="RequireAllConditions" type="checkbox" value="@rule.RequireAllConditions" />
                                        </div>
                                </div>
                                <div class="row align-items-center justify-content-start">
                                    <div class="col-1"></div>
                                    <div class="col-9">
                                        <p class="lead">Conditions</p>
                                        @if (rule.Conditions == null)
                                        {
                                            <p>No conditions (null).</p>
                                        }
                                        else
                                        {
                                            @if(rule.Conditions.Count == 0)
                                            {
                                                <p>No conditions.</p>
                                            }
                                            else
                                            {
                                                @foreach (var cond in rule.Conditions)
                                                {
                                                    <tr>
                                                        <td>
                                                            <p>@cond.Id</p>
                                                            <p>@cond.OnThis</p>
                                                        </td>
                                                    </tr>
                                                }
                                            }
                                        }                                        
                                    </div>
                                </div>
                                <div class="row align-items-end justify-content-start">
                                    <div class="col-1"><small class="text-muted">Rule ID: @rule.Id</small></div>
                                    <div class="col-9">
                                        <p class="lead">Actions</p>
                                        @if (rule.Actions == null)
                                        {
                                            <p>No actions (null).</p>
                                        }
                                        else
                                        {
                                            @if(rule.Actions.Count == 0)
                                            {
                                                <p>No actions.</p>
                                            }
                                            else
                                            {
                                                @foreach (var act in rule.Actions)
                                                {
                                                    <tr>
                                                        <td>
                                                            <p>@act.Id</p>
                                                            <p>@act.DirectObject</p>
                                                        </td>
                                                    </tr>
                                                }
                                            }                                        
                                        }
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </Virtualize>
            </tbody>
        </table>
    }
}